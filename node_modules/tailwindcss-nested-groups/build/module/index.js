import selectorParser from 'postcss-selector-parser';
import plugin from 'tailwindcss/plugin';
const nestedGroupPlugin = plugin(({ theme, addVariant, prefix, e: escape }) => {
    const groupLevel = theme('groupLevel') || 10;
    const groupScope = theme('groupScope') || 'scope';
    const groupVariants = theme('groupVariants') || ['hover', 'focus'];
    groupVariants.forEach((groupVariant) => {
        addVariant(`group-${groupVariant}`, ({ modifySelectors, separator }) => {
            return modifySelectors(({ selector }) => {
                return selectorParser((root) => {
                    root.walkClasses((node) => {
                        // Regular group
                        const value = node.value;
                        // eslint-disable-next-line functional/immutable-data
                        node.value = `group-${groupVariant}${separator}${value}`;
                        if (node.parent && node.parent.parent) {
                            node.parent.insertBefore(node, selectorParser().astSync(prefix(`.group:${groupVariant} `)));
                            // Named groups
                            node.parent.parent.insertAfter(node.parent, selectorParser().astSync(Array.from(Array(groupLevel))
                                .map((_x, index) => `${prefix(`.group-${groupScope}:${groupVariant}${Array.from(Array(index))
                                .map(() => ` > :not(.group-${groupScope})`)
                                .join('')} > .`)}${escape(`group-${groupScope}-${groupVariant}${separator}${value}`)}`)
                                .join(',')));
                        }
                    });
                }).processSync(selector);
            });
        });
    });
});
export default nestedGroupPlugin;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxjQUF3QixNQUFNLHlCQUF5QixDQUFDO0FBQy9ELE9BQU8sTUFBTSxNQUFNLG9CQUFvQixDQUFDO0FBRXhDLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRTtJQUM1RSxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzdDLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUMsSUFBSSxPQUFPLENBQUM7SUFDbEQsTUFBTSxhQUFhLEdBQUcsS0FBSyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBRW5FLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFZLEVBQUUsRUFBRTtRQUNyQyxVQUFVLENBQUMsU0FBUyxZQUFZLEVBQUUsRUFBRSxDQUFDLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUU7WUFDckUsT0FBTyxlQUFlLENBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUU7Z0JBQ3RDLE9BQU8sY0FBYyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7b0JBQzdCLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTt3QkFDeEIsZ0JBQWdCO3dCQUNoQixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO3dCQUN6QixxREFBcUQ7d0JBQ3JELElBQUksQ0FBQyxLQUFLLEdBQUcsU0FBUyxZQUFZLEdBQUcsU0FBUyxHQUFHLEtBQUssRUFBRSxDQUFDO3dCQUV6RCxJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7NEJBQ3JDLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUN0QixJQUFJLEVBQ0osY0FBYyxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLFlBQVksR0FBRyxDQUFDLENBQUMsQ0FDNUQsQ0FBQzs0QkFFRixlQUFlOzRCQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FDNUIsSUFBSSxDQUFDLE1BQWMsRUFDbkIsY0FBYyxFQUFFLENBQUMsT0FBTyxDQUN0QixLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztpQ0FDMUIsR0FBRyxDQUNGLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLENBQ1osR0FBRyxNQUFNLENBQ1AsVUFBVSxVQUFVLElBQUksWUFBWSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQy9DLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FDYjtpQ0FDRSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsa0JBQWtCLFVBQVUsR0FBRyxDQUFDO2lDQUMxQyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FDbEIsR0FBRyxNQUFNLENBQ1IsU0FBUyxVQUFVLElBQUksWUFBWSxHQUFHLFNBQVMsR0FBRyxLQUFLLEVBQUUsQ0FDMUQsRUFBRSxDQUNOO2lDQUNBLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FDYixDQUNGLENBQUM7eUJBQ0g7b0JBQ0gsQ0FBQyxDQUFDLENBQUM7Z0JBQ0wsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzNCLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsZUFBZSxpQkFBaUIsQ0FBQyJ9